# korean_TE_baseline

본 소스 코드는 '국립국어원 인공 지능 언어 능력 평가' 시범 운영 과제 중 '함의분석' 과제 베이스라인 모델 및 학습과 평가를 위한 코드입니다.

코드는 'textual_entailment.py'이며 ' train.sh'를 이용하여 학습할 수 있습니다. 또 'demo.sh' 를 학습된 모델에 활용하여 결과를 생성한 뒤, 'test.sh'를 실행하면 결과물에 대한 평가를 할 수 있습니다.




## 데이터

데이터는 국립국어원 '모두의 말뭉치( https://corpus.korean.go.kr )'에서 다운 받으실 수 있습니다.

데이터의 개인 정보는 비식별화 되어 있습니다.

#### 예시

``` 
{"id": "nikluge-2023-te-train-000001", "input": {"premise": "경찰은 현재 과학수사 수준이 사건 발생 당시보다 비약적으로 발전한 점에 착안해 지난해 7월 15일 피해자 유류품을 국립과학수사연구원으로 보내 DNA 검출·분석을 의뢰했다. 지난해 8월 9일 9차 사건 유류품에서 이춘재의 DNA가 처음 검출됐고 그의 자백이 더해져 1년에 걸친 재수사는 마무리됐다.", "proposition": "국립과학수사연구원은 경찰의 의뢰를 받아들여 피해자 유류품을 분석했을 것이다."}, "output": "entailment"}
{"id": "nikluge-2023-te-train-000002", "input": {"premise": "다만 미국의 행동에 따라 조치를 취하겠다는 논리를 편 것은 여전히 트럼프 대통령의 재선 가능성을 고려해 대화의 창은 완전히 닫지 않았다는 방증이라는 관측도 나온다. 김정 북한대학원대 교수는 “한미의 관심을 끌고자 저강도 도발은 할 수 있으나 ‘레드라인’인 핵실험이나 대륙간탄도미사일(ICBM) 시험발사는 리스크가 크다고 생각할 것”이라고 말했다.", "proposition": "현시점에서는 아직 다음 미국 대선의 결과가 나오지 않았다."}, "output": "entailment"}
{"id": "nikluge-2023-te-train-000003", "input": {"premise": "우리나라 상반기 총 수출규모는 2406억 달러로 전년 동기대비 11.3% 감소했는데, 부산의 수출 감소폭은 전국의 2배에 육박한다. 이처럼 부진이 두드러지면서 부산의 지자체 수출 순위는 11위, 수출증감률은 14위로 최하위권을 기록했다.", "proposition": "부산의 수출 감소 폭이 전국의 두 배에 달함에도 불구하고 그보다 수출규모가 작은 지자체가 존재한다."}, "output": "entailment"}
{"id": "nikluge-2023-te-train-000004", "input": {"premise": "이 흐름이 팬데믹 이후 심화했고 유럽에서 사회 안전망이 가장 잘 돼있다고 여겨지는 국가에서도 기아와 빈곤 상황이 심각해졌다. 빈곤 퇴치 단체들은 위기를 근본적으로 해결하려면 식량 생산과 공급, 분배 시스템 전반을 재점검해야 한다고 주장한다.", "proposition": "코로나19 이후로 빈곤 위기를 크게 느끼지 못했던 국가에서도 기아와 빈곤 문제가 심각해지기 시작했다."}, "output": "entailment"}
```

#### 데이터 전처리

모델을 학습하기 위한 데이터 전처리는 소스코드의 tokenize_and_align_labels 함수와 get_dataset 함수를 참고하시면 됩니다. tokenize_and_align_labels에서 데이터를 1차 가공하고, get_dataset에서 pytorch의 DataLoader를 이용하기 위한 TensorDataset 형태로 가공합니다.


## 모델 구성

klue/roberta-base( https://huggingface.co/klue/roberta-base )를 기반으로 학습하였습니다.

모델 구조는 klue/roberta-base 모델의 \<s> 토큰 output에 SimpleClassifier를 붙인 형태의 모델입니다.

학습된 베이스라인 모델은 아래 링크에서 받으실 수 있습니다.

model link:

모델 입력 형태를 \<s>premise\</s>\</s>proposition\</s>로 하고 entailment, contradiction, neutral 세 가지 중 하나로 분류합니다.


#### 입력 예시

```
<s>경찰은 현재 과학수사 수준이 사건 발생 당시보다 비약적으로 발전한 점에 착안해 지난해 7월 15일 피해자 유류품을 국립과학수사연구원으로 보내 DNA 검출·분석을 의뢰했다. 지난해 8월 9일 9차 사건 유류품에서 이춘재의 DNA가 처음 검출됐고 그의 자백이 더해져 1년에 걸친 재수사는 마무리됐다.</s></s>국립과학수사연구원은 경찰의 의뢰를 받아들여 피해자 유류품을 분석했을 것이다.</s>
```

#### 출력 예시 - entailment, contradiction, neutral 중 하나

```
entailment
```

#### 평가

baseline 코드에서 제공된 평가 코드로 평가하였을때, 아래와 같이 결과가 나왔습니다.

train 과정에서 --do_eval을 argument로 전달하면 매 epoch마다 dev data에 대해 평가 결과를 보여줍니다.

demo.sh을 이용하여 결과물을 추출한뒤 평가 데이터를 이용하여 test.sh와 같이 평가할 수 있습니다.

모델을 이용하여 pred_data와 같은 형태의 데이터를 만들기 위한 방법은 demo.sh 파일을 참고하면 됩니다.

평가함수는 evaluation(y_true, y_pred) 함수를 이용하면 되고, 입력 데이터는 아래와 같습니다.

true_data

``` 
{"id": "nikluge-2023-te-dev-000001", "input": {"premise": "시리즈 1차분에는 김언희의 첫 시집 ‘트렁크’를 필두로 김사인 ‘밤에 쓰는 편지’, 이수명 ‘새로운 오독이 거리를 메웠다’, 성석제 ‘낯선 길에 묻다’, 성미정 ‘대머리와의 사랑’, 함민복 ‘우울씨의 일일’, 진수미 ‘달의 코르크 마개가 열릴 때까지’, 박정대 ‘단편들’, 유형진 ‘피터래빗 저격사건’, 박상수 ‘후르츠 캔디 버스’가 들어 있다.", "proposition": "시리즈 1차분에는 10가지 시가 들어있다."}, "output": "contradiction"}
{"id": "nikluge-2023-te-dev-000002", "input": {"premise": "그러나 소비자분쟁위원회는 통신사가 통신사가 계약의 중요한 내용인 보상 범위를 정확하고 알기 쉽게 전달할 의무를 소홀히 했다고 봤다. 통신사 홈페이지와 A씨가 받은 약관에는 보상 범위가 ‘파손’으로만 적혀 있는데다, 보상 제외 범위가 작은 글씨로 쓰여 있어 가입자들이 내용을 쉽게 인식하기 어렵다는 것이다.", "proposition": "가입자들은 실제 보상 범위보다 더 많은 범위를 보상 받는 것으로 오해했을 것이다."}, "output": "entailment"}
{"id": "nikluge-2023-te-dev-000003", "input": {"premise": "경찰과 소방당국에 따르면 7일 오전 5시51분쯤 ‘펑’하는 폭발음과 함께 원주의 한 아파트 6층에서 화재가 발생했다. 불은 아파트 내부 112㎡ 중 33㎡를 태운 뒤 소방대원 등에 의해 진화됐다.", "proposition": "원주의 6층 아파트에서 소음과 함께 화재가 발생하였다."}, "output": "neutral"}
{"id": "nikluge-2023-te-dev-000004", "input": {"premise": "평소에는 뚜껑처럼 노심에서 나오는 방사선을 차단하지만 핵연료 교체 등의 작업 시에는 일시적으로 제거해 격납용기에 접근할 수 있는 출입구 역할을 한다. 규제위의 이번 조사에서 원전 2호기 실드 플러그에 부착된 세슘137의 양은 약 20~40페타 베크렐(PBq·1PBq은 1000조 Bq), 3호기의 경우 30페타 베크렐로 추정됐다.", "proposition": "실드 플러그의 역할은 하나에 지나지 않는다."}, "output": "entailment"}
```


pred_data

```
{"id": "nikluge-2023-te-dev-000001", "input": {"premise": "시리즈 1차분에는 김언희의 첫 시집 ‘트렁크’를 필두로 김사인 ‘밤에 쓰는 편지’, 이수명 ‘새로운 오독이 거리를 메웠다’, 성석제 ‘낯선 길에 묻다’, 성미정 ‘대머리와의 사랑’, 함민복 ‘우울씨의 일일’, 진수미 ‘달의 코르크 마개가 열릴 때까지’, 박정대 ‘단편들’, 유형진 ‘피터래빗 저격사건’, 박상수 ‘후르츠 캔디 버스’가 들어 있다.", "proposition": "시리즈 1차분에는 10가지 시가 들어있다."}, "output": "contradiction"}
{"id": "nikluge-2023-te-dev-000002", "input": {"premise": "그러나 소비자분쟁위원회는 통신사가 통신사가 계약의 중요한 내용인 보상 범위를 정확하고 알기 쉽게 전달할 의무를 소홀히 했다고 봤다. 통신사 홈페이지와 A씨가 받은 약관에는 보상 범위가 ‘파손’으로만 적혀 있는데다, 보상 제외 범위가 작은 글씨로 쓰여 있어 가입자들이 내용을 쉽게 인식하기 어렵다는 것이다.", "proposition": "가입자들은 실제 보상 범위보다 더 많은 범위를 보상 받는 것으로 오해했을 것이다."}, "output": "entailment"}
{"id": "nikluge-2023-te-dev-000003", "input": {"premise": "경찰과 소방당국에 따르면 7일 오전 5시51분쯤 ‘펑’하는 폭발음과 함께 원주의 한 아파트 6층에서 화재가 발생했다. 불은 아파트 내부 112㎡ 중 33㎡를 태운 뒤 소방대원 등에 의해 진화됐다.", "proposition": "원주의 6층 아파트에서 소음과 함께 화재가 발생하였다."}, "output": "neutral"}
{"id": "nikluge-2023-te-dev-000004", "input": {"premise": "평소에는 뚜껑처럼 노심에서 나오는 방사선을 차단하지만 핵연료 교체 등의 작업 시에는 일시적으로 제거해 격납용기에 접근할 수 있는 출입구 역할을 한다. 규제위의 이번 조사에서 원전 2호기 실드 플러그에 부착된 세슘137의 양은 약 20~40페타 베크렐(PBq·1PBq은 1000조 Bq), 3호기의 경우 30페타 베크렐로 추정됐다.", "proposition": "실드 플러그의 역할은 하나에 지나지 않는다."}, "output": "entailment"}
```

dev 데이터에 대한 베이스라인의 평가 결과는 아래와 같습니다.

| 모델              | F1-micro   | F1-macro |
| ----------------- | ---- | ---- |
| klue/roberta-base | 0.68 | 0.52 |


## reference

klue/roberta-base in huggingface (https://huggingface.co/klue/roberta-base)

국립국어원 모두의말뭉치 (https://corpus.korean.go.kr/)

## Authors

- 정용빈, Teddysum, ybjeong@teddysum.ai
